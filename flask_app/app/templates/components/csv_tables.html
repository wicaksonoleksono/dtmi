<!-- CSV Tables Component -->
<div
  x-show="message.csvTables && message.csvTables.length > 0"
  class="mt-6 ml-14 space-y-4"
>
  <template x-for="(table, index) in message.csvTables" :key="'table-' + index">
    <div
      class="rounded-2xl shadow-lg backdrop-blur-sm overflow-hidden"
      :class="darkMode ? 'bg-claude-surface-dark/80 border border-claude-border-dark' : 'bg-claude-surface/80 border border-claude-border'"
      x-data="{ isOpen: false, isLoading: table.loading || false }"
    >
      <!-- Table Header -->
      <button
        @click="isOpen = !isOpen"
        class="w-full px-6 py-4 flex items-center justify-between transition-all duration-200 hover:opacity-80"
      >
        <div class="flex items-center space-x-4">
          <div
            class="w-8 h-8 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center"
          >
            <svg
              x-show="!isLoading"
              class="w-4 h-4 text-white"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M5 4a1 1 0 00-1 1v10a1 1 0 001 1h10a1 1 0 001-1V5a1 1 0 00-1-1H5zM4 2a3 3 0 00-3 3v10a3 3 0 003 3h10a3 3 0 003-3V5a3 3 0 00-3-3H4zm2 4h8v2H6V6zm0 4h8v2H6v-2z"
                clip-rule="evenodd"
              />
            </svg>
            <div
              x-show="isLoading"
              class="w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"
            ></div>
          </div>
          <div class="text-left">
            <h4
              class="font-medium"
              x-text="table.caption || table.filename || 'Data Table'"
            ></h4>
            <p
              class="text-xs opacity-70"
              x-text="isLoading ? 'Memuat...' : table.filename"
            ></p>
          </div>
        </div>
        <div class="flex items-center space-x-3">
          <span
            x-show="!isLoading"
            class="text-xs px-3 py-1 rounded-full bg-claude-orange-muted text-claude-orange"
            x-text="(table.showing_rows || 0) + ' baris'"
          ></span>
          <span
            x-show="isLoading"
            class="text-xs px-3 py-1 rounded-full bg-gray-200 text-gray-600 animate-pulse"
          >
            Loading...
          </span>
          <svg
            class="w-5 h-5 transition-transform duration-200"
            :class="isOpen ? 'rotate-180' : ''"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
        </div>
      </button>

      <!-- Table Content -->
      <div
        x-show="isOpen"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 transform -translate-y-2"
        x-transition:enter-end="opacity-100 transform translate-y-0"
      >
        <div class="max-h-80 overflow-auto" style="scrollbar-width: thin">
          <div x-show="isLoading" class="p-8 flex justify-center">
            <div class="flex items-center space-x-3">
              <div
                class="w-4 h-4 border-2 border-claude-orange border-t-transparent rounded-full animate-spin"
              ></div>
              <span class="text-sm opacity-70">Memuat data tabel...</span>
            </div>
          </div>

          <table x-show="!isLoading && table.headers" class="min-w-full">
            <thead
              class="sticky top-0"
              :class="darkMode ? 'bg-claude-bg-dark' : 'bg-claude-bg'"
            >
              <tr>
                <template x-for="header in table.headers" :key="header">
                  <th
                    class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider opacity-70"
                    x-text="header"
                  ></th>
                </template>
              </tr>
            </thead>
            <tbody>
              <template
                x-for="(row, rowIndex) in table.rows"
                :key="'row-' + rowIndex"
              >
                <tr
                  class="transition-colors duration-150"
                  :class="rowIndex % 2 === 0 ? (darkMode ? 'bg-claude-surface-dark/30' : 'bg-claude-surface/30') : ''"
                >
                  <template
                    x-for="(cell, cellIndex) in row"
                    :key="'cell-' + cellIndex"
                  >
                    <td
                      class="px-4 py-3 text-sm max-w-xs truncate"
                      :title="cell"
                      x-text="cell"
                    ></td>
                  </template>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </template>
</div>
